<link rel="import" href="../../../bower_components/polymer/polymer.html">

<link rel="import" href="../../elements/disaggregations/disaggregation-table.html">

<dom-module id="edit-disaggregation-table">
  <template>
    <style>
      :host {
        display:block;
      }
    </style>
    <disaggregation-table
      total=[[item.total]]
      data=[[data]]
      mapping=[[mapping]]
      class="fullWidth"
      editable>
    </disaggregation-table>
  </template>

  <script>
    Polymer({
      is: 'edit-disaggregation-table',

      behaviors: [
        App.Behaviors.ReduxBehavior,
      ],

      properties: {
        data: {
          type: Object,
          value: {}
        },
        mapping: {
          type: Object,
          value: {}
        },
        item: {
          type: Object,
          value: {}
        },
      },

      listeners: {
        'field-changed': '_onFieldChanged',
      },
      _onFieldChanged: function (e) {
        var disaggKey = '(' + this.mapping[0].choices[e.detail.colIndex].id +
                        ', ' + this.mapping[1].choices[e.detail.rowIndex].id + ')';
        var payload = {
          'indicator': this.item.id,
          'location': this.data.id,
          'key': disaggKey,
          'value': +e.detail.value
        };
        // Send to Redux
        console.log(payload);
      },
      attached: function () {
        // Find the existing indicator data in Redux using these IDs and clone it;
        // this will be the new version.
        console.log('indicator ID: ' + this.item.id + ', location ID: ' + this.data.id);
      }
    });
  </script>
</dom-module>
